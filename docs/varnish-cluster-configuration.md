# VarnishCluster Configuration

| Field                                              | Description                                                                                                                                                                                     | Is Required |
|----------------------------------------------------|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------|
| `vcl                                             ` | An object that defines the [VCL ConfigMap configuration](vcl-configuration.md)                                                                                                                  | `required`  |
| `vcl.configMapName                               ` | Name of the ConfigMap containing the VCL configuration files                                                                                                                                    | `required`  |
| `vclConfgiMap.entrypointFileName                 ` | The name of the main VCL file                                                                                                                                                                   | `required`  |
| `varnish                                         ` | An object that defines the configuration of a particular Varnish instance being deployed                                                                                                        | `optional`  |
| `varnish.image                                   ` | Path to the Varnish image being used                                                                                                                                                            | `optional`  |
| `varnish.imagePullPolicy                         ` | Image pull policy for the containers. Default: `Always`                                                                                                                                         | `optional`  |
| `varnish.restartPolicy                           ` | Restart policy for the containers. Default: `Always`                                                                                                                                            | `optional`  |
| `varnish.imagePullSecret                         ` | The [kubernetes secret used to pull images](https://kubernetes.io/docs/concepts/configuration/secret/#using-imagepullsecrets) from private container registry                                   | `optional`  |
| `varnish.args                                    ` | Additional [Varnish daemon arguments](https://varnish-cache.org/docs/trunk/reference/varnishd.html#options)                                                                                     | `optional`  |
| `varnish.resources                               ` | [Resource requests and limits](https://kubernetes.io/docs/concepts/configuration/manage-compute-resources-container/#resource-requests-and-limits-of-pod-and-container) for Varnish containers. | `optional`  |
| `updateStrategy                                  ` | Allows to control the way Varnish pods will be [updated](https://kubernetes.io/docs/tutorials/stateful-application/basic-stateful-set/#updating-statefulsets).                                  | `optional`  |
| `updateStrategy.type                             ` | Defines the type of the update strategy. Default: `OnDelete`                                                                                                                                    | `optional`  |
| `updateStrategy.rollingUpdate                    ` | Used to communicate parameters when type is `RollingUpdate`                                                                                                                                     | `optional`  |
| `updateStrategy.rollingUpdate.partition          ` | Partition indicates the ordinal at which the StatefulSet should be partitioned. Default: 0                                                                                                      | `optional`  |
| `updateStrategy.delayedRollingUpdate             ` | Configuration for `DelayedRollingUpdate` strategy                                                                                                                                               | `optional`  |
| `updateStrategy.delayedRollingUpdate.delaySeconds` | Indicates the wait time between pod reloads during rolling update. Default: 60 seconds                                                                                                          | `required`  |
| `affinity                                        ` | [Affinity](https://kubernetes.io/docs/concepts/configuration/assign-pod-node/#affinity-and-anti-affinity) settings for the pods.                                                                | `optional`  |
| `tolerations                                     ` | Configuration that defines which node [taints](https://kubernetes.io/docs/concepts/configuration/taint-and-toleration/) can the pods tolerate.                                                  | `optional`  |
| `podDisruptionBudget                             ` | [Pod Disruption Budget](https://kubernetes.io/docs/tasks/run-application/configure-pdb/#specifying-a-poddisruptionbudget) configuration                                                         | `optional`  |
| `podDisruptionBudget.maxUnavailable              ` | An eviction is allowed if at most `maxUnavailable` pods are unavailable after the eviction, i.e. even in absence of the evicted pod. This is a mutually exclusive setting with `minAvailable`   | `optional`  |
| `podDisruptionBudget.minAvailable                ` | An eviction is allowed if at least `minAvailable` pods will still be available after the eviction, i.e. even in the absence of the evicted pod                                                  | `optional`  |
| `service                                         ` | Varnish service configuration.                                                                                                                                                                  | `required`  |
| `service.port                                    ` | The port number used to expose Varnish pods.                                                                                                                                                    | `required`  |
| `service.metricsExporterPort                     ` | The port that will expose the Prometheus metrics exporter. Default: `9131`                                                                                                                      | `optional`  |
| `backend.selector                                ` | The selector used to identify the backend Pods.                                                                                                                                                 | `optional`  |
| `backend.port                                    ` | The port of the backend pods being cached by Varnish. Can be port name or port number.                                                                                                          | `optional`  |
| `logLevel                                        ` | The minimum enabled logging level. Allowed values: `debug`, `info`, `warn`, `error`, `dpanic`, `panic`, `fatal`. Default: `info`                                                                | `optional`  |
| `logFormat                                       ` | Format of the logs. Can be `json` and `console`. Default: `json`                                                                                                                                | `optional`  |

You can also find an example of `VarnishCluster` with detailed comments [here](https://github.ibm.com/TheWeatherCompany/icm-varnish-k8s-operator/blob/master/config/samples/icm_v1alpha1_varnishcluster.yaml). 